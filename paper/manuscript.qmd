---
title: "A family of accessibility measures"
format: pdf
bibliography: "`r system('kpsewhich ../bibliography/bibliography.bib', intern=TRUE)`"
nocite: |
  @careyPrinciplesSocialScience1858, @ravensteinLawsMigration1889, @ravensteinLawsMigration1885
---

```{r knitr-setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  cache = FALSE,
  warning = FALSE,
  message = FALSE,
  comment = '', 
  out.width = "1\\linewidth")
```

```{r load-packages, include=FALSE, cache=FALSE}
library(dplyr) # A Grammar of Data Manipulation
library(fitdistrplus) # Help to Fit of a Parametric Distribution to Non-Censored or Censored Data
library(geomtextpath) # Curved Text in 'ggplot2'
library(ggforce) # Accelerating 'ggplot2'
library(ggplot2) # Create Elegant Data Visualisations Using the Grammar of Graphics
library(ggpmisc) # Miscellaneous Extensions to 'ggplot2'
library(ggrepel) # Automatically Position Non-Overlapping Text Labels with 'ggplot2'
library(ggspatial) # Spatial Data Framework for ggplot2
library(gridExtra) # Miscellaneous Functions for "Grid" Graphics 
library(here)

# library(huxtable) # Easily Create and Style Tables for LaTeX, HTML and Other Formats
# library(kableExtra) # Construct Complex Table with 'kable' and Pipe Syntax
# library(patchwork) # The Composer of Plots
# library(RColorBrewer) # ColorBrewer Palettes
# library(sf) # Simple Features for R
# library(scales) # Scale Functions for Visualization
# library(shadowtext) # Shadow Text Grob and Layer
# library(skimr) # Compact and Flexible Summaries of Data
# library(spdep) # Spatial Dependence: Weighting Schemes, Statistics
# library(tidyr) # Tidy Messy Data
# library(tmap) # Thematic Maps
```

# Introduction

<!--The inquiry into spatial interaction traces to Newts Universal Gravitation-->
The patterns of people's movement in space have been a subject of scientific inquiry for centuries. From as far back as 1858 with Carey's Principles of Social Science where he stated that "man [is] the molecule of society [and their interaction is subject to] the direct ratio of the mass and the inverse one of distance" [see McKean's -@mckeanManual1883 Manual of Social Science, pp. 37-38], investigations of how people interact in space has often been  explicitly coloured by the features of Newton's Law of Universal Gravitation, as posited in his _Principia Mathematica_ of 1687 (see @eq-grav-prop):

$$
F_{ij} \propto \frac{M_i M_j} {D_{ij}^{2}}
$${#eq-grav-prop}

@eq-grav-prop is one of the most famous equations in all of science, and it states that the force of attraction $F$ between a pair of bodies $i$ and $j$ is directly _proportional_ to the product of their masses $M_i$ and $M_j$, and inversely _proportional_ to the square of the distance between them $D_{ij}$. Direct proportionality only means that as the product of the masses increases, so does the force. Likewise, inversely proportional only means that as the distance increases, the force decreases. To actually quantify the force, an empirical factor is required to convert the expression for the proportionality into an equation, which ensures that the force $F$ matches empirical observations of the attraction between masses. Ultimately, the equation for the force is as seen in @eq-grav:

$$
F_{ij} = G \frac{M_i M_j} {D_{ij}^{2}}
$${#eq-grav}

\noindent where $G$ is a proportionality constant obtained empirically, and called _Cavendish gravitational constant_, after Henry Cavendish's experimental results of 1798--more than a century after Newton's _Principia_ was published--that brought it to within 1\% accuracy level.

<!--Using Newts Universal Gravitation: Ravenstein 1889 to Stewart 1948-->
Following Carey, research into human spatial interaction continued apace in different contexts. In 1885 and 1889 Ravenstein (who appears to have been unaware of Carey's treatise) proposed his "Laws of Migration", based on his empirical analysis of migration flows in various countries. In these works, Ravenstein posited a directly proportional relationship with the size of the destination (i.e., centres of commerce and industry), and an inversely proportional relationship between the size of flows and separation between origin and destination, a clear similitude to gravitational laws. Other researchers kept discovering, seemingly independently, principles of human spatial interaction that resembled Newton's universal law of gravitation. For example, @reilly1929methods (who seems to have been unaware of Carey and Ravenstein) formulated a law of retail gravitation  <!--Rilley does not cite Newton, nor Carey, nor Ravenstein-->, expressed in terms of equal attraction to competing retail destinations. Later, Zipf (seemingly unaware of Carey, Ravenstein, and Rilley) proposed a $\frac{P_1P_2}{D}$ hypothesis for the case of goods movement by railways @zipfHypothesisCaseRailway1946, intercity personal movement @zipfHypothesisIntercityMovement1946,and information @zipfDeterminantsCirculationInformation1946. This hypothesis stated that the magnitude of flows was proportional to the product of the populations of settlements, and inversely proportional to the distance between them. 

A common theme among these early researchers of human spatial interaction is that a proportionality constant is missing. Of the researchers cited here, only Reilly and Zipf expressed their hypotheses in mathematical terms. In this way, Reilly expressed his hypothesis as follows:
$$
B_a = \frac{(P_a\cdot P_T)^N}{D_{aT}^n}
$${#eq-reilly}

\noindent where $B_a$ is the businness drawn to $a$ from $T$, $P_a$ and $P_T$ are the populations of the two settlements, and $D_{aT}$ is the distance between them. Quantity $N$ was chosen by Reilly in a somewhat ad hoc fasion as 1, and he used empirical observations of shoppers to choose a value of $n = 2$. 

Zipf, on the other hand, expressed his hypothesis as:
$$
C^2 = \frac{P_1\cdot P_2}{D}
$${#eq-zipf}

\noindent where $C$ is the volume of goods exchanged between $1$ and $2$, $P_1$ and $P_2$ are the populations of the two settlements, and  $D_{12}$ is the distance between them.

After Carey, it is in Stewart's [-@stewartDemographicGravitationEvidence1948] work on the principles of demographic gravitation that we find the strongest connection yet to Newton's law (Stewart was a physicist, whereas Ravenstein, Reilly, and Zipf were social scientists), and also recognition of preceding research, as he cites Reilly and Zipf as predecessors in the analysis of human spatial interaction. Stewart appears to be the first author to express his theorized relationships for human spatial interaction with a proportionality constant, as follows:
$$
F = G\frac{(N_1\mu_1)(N_2\mu_2)}{d_{12}^2}
$${#eq-stewart-force}

\noindent where:

- $F$ is the _demographic force_
- $N_1$ and $N_2$ are the numbers of people of in groups 1 and 2
- $\mu_1$ and $\mu_2$ are so-called _molecular weights_
- $d_{12}^2$ is the distance between $1$ and $2$
- And finally $G$, a constant that Stewart "left for future determination" [-@stewartDemographicGravitationEvidence1948, p. 34]

In addition to demographic force, Stewart defined a measure of "population potential" of $2$ with respect to $1$ as follows:
$$
V_1 = G\frac{M_2}{d}
$${#eq-stewart-population-potential}

For a system with more than 2 population bodies, Stewart formulated the population potential at $i$ as:
$$
V_i = \int\frac{D}{r} ds
$${#eq-stewart-population-potential-integral}

\noindent where $D$ is population density over an infinitesimal area $ds$, and $r$ is the distance to $i$. In more contemporary terms, this could be rewritten as:
$$
V_i = \sum_j \frac{M_j}{d_{ij}}
$${#eq-stewart-population-potential-sum}

\noindent which astute readers will identify as our modern definition of accessibility.

Stewart's formulation of demographic force, developed in the context of what he called "social physics" [@stewartPrinciples1947], was problematic and had issues with inconsistent mathematical notation [e.g., in Stewart's 1948 paper, $G$ is used as a proportionality constant on p. 34 and again for the demographic energy on p. 54], but perhaps more seriously, it was permeated by a view of humans as particles and afflicted by unmitigated racism (Stewart assumed that the "molecular weight" $\mu$ was one for the average American, but "presumably...much less than one" for an Australian Aboriginal; p. 34). Eventually, Stewart's ideas about "social physics" fell out of favor among social scientists, but not before influencing Walter G. Hansen, then a student of city and regional planning at Massachusetts Institute of Technology.

<!--Hansen leans on Stewart's 1948 Population Potential measure. Two crucial things: 1) Stewart set the proportional constant to 1 *for future determination* and 2) Stewart suggests that keeping the exponent value of d_ij as 1 is sufficient. Hansen doesn't address the proportional constant of 1 explicitly in his application and picks an exponent other than 1 for d_ij as it fits empirically better: the issue of units are never addressed. -->
Hansen, was an engineer with the the Bureau of Roads in the United States, and preoccupied with transportation's power to shape land uses. As such, he was neither scientist nor social scientist, but rather an applied researcher. Hansen's [-@hansen1959] paper in the Journal of the American Planning Association was instrumental in shedding some of the less convincing, or frankly objectionable, aspects of "social physics", to recast accessibility not as a model of physics, but as a model useful to capture regularities in human spatial behavior. The result of this was accessibility as the  _"potential of opportunities for interaction"_. Today, @hansen1959 is frequently cited as the father of modern accessibility analysis [e.g., @reggianiGuestEditorialNew2011] and Hansen-type accessibility is commonly referred to today as the gravity-based accessibility measure. 

In his work, @hansen1959 borrowed the idea of a "population potential" of @stewartDemographicGravitationEvidence1948, which closely follows the Newtonian definition of energy potential, and applied it to the measurement of the potential of opportunities. As noted above, the integral of $F_{ij}$ (@eq-grav-prop) over distance $d_{ij}$: $U_{ij}=-G M_{i}M_{j} /d_{ij}$. The potential energy of one mass, say $M_i$, is hence $U_i = G M_j / d_{ij}$, when applied to population instead of mass this equation yields "potential population". @hansen1959 took this equation and replaces $M_j$ with _opportunities_ to derive _opportunity potential_ or, as Hansen defines, _potential of opportunities for interaction_.]


(@eq-2):
$$
S_{ij} = O_j \cdot d_{ij}^\beta \\
$${#eq-accessibility}

 
$S_{ij}$ is a relative measure of the accessibility at $i$ to an activity located at $j$, $O_j$ is the size of the activity at $j$ and $d_{ij}$ is the distance or travel time between $i$ and $j$ with $\beta$ describing the effect size. ^[Notably, @Hansen1959 finds that when the model is empirically calibrated, ${\beta}$ takes a value of between 0.5 to 3, not the value of 1 as consistent in the Newtonian potential energy relationship.]



Of note, however is that @hansen1959's formulation omits a proportionality constant akin to the function of $G$ in @eq-grav. Interestingly, as @hansen1959 draws from @stewartDemographicGravitationEvidence1948, @stewartDemographicGravitationEvidence1948 sets the proportionality constant to 1, stating _"the constant G is left for future determination: a suitable choice of other units can reduce it to unity"_. Without a proportionality constant, however, the units of $S_ij$ are unclear: the unit of 'potential of opportunity for interaction' is left free to change as $\beta$ is calibrated for the population center with no discussion of a constant to balance the units. @eq-3 is the form of gravity-based accessibility measure commonly presented today. It is re-written with $S_i$ being the relative measure of the accessibility at $i$ to all activities $j$, and instead of $d_{ij}^\beta$, $f(c_{ij})$ is any monotonically decreasing function of travel cost $c_{ij}$.

$$
S_{i} = \sum_j O_j * f(c_{ij})
$${#eq-3}

<!--Accessibility from Hansen to today: very diverse, hard to interpret, and its lack of concern for the proportionality constant.  Our answer: the proportionality constant.-->
Since @hansen1959, accessibility analysis has been widely employed across planning disciplines, but to the authors knowledge, have not been concerned with explicitly determining a proportionality constant. The majority of studies develop on the breath of opportunity $O_j$ studied (i.e., work, shopping, schools, leisure () and their geographic case study selection, the accuracy of parameters that capture distance-decay $f(c_{ij})$ (), and additions to the opportunity $O_j$ attribute such as competitive demand considerations [@stoufferINTERVENINGOPPORTUNITIESCOMPETING1960; @weibull_axiomatic_1976; @shen1998; @allenMeasureCompetitiveAccess2020; @soukhovMultimodalSpatialAvailability2024]. However, the difficulty in interpreting gravity-based accessibility's meaning as anything other than a relative index of potential interaction, plagues it to this day and contributes to resistance to its application in practice(). The quantity and variations on @eq-3 compounds this issue of interpretability across studies. A testament to this inconsistent interpretation are the unsettled classifications generated by influential review works of the accessibility literature; for instance, @handyMeasuringAccessibilityExploration1997 classifies studies into gravity- and utility-based measures, @geursAccessibilityEvaluationLanduse2004 introduces further classification by expanding categories into potential- (gravity), utility-, location-, and person- based measures with different components, and @wuUnifyingAccess2020 demonstrates that the concept can be re-unified into its main features: the relationship between travel-cost and corresponding reachable opportunities and demonstrates how previous classifications are special cases of travel-cost or opportunities constraints. From the initial Newtonian analogy, we interpret @wuUnifyingAccess2020's work as offering a positive contribution by circling back to re-unify mass $M$ and separation distance $D$; however, an important component is still missing - the proportionality constant $G$. The aim of this paper's focus is on the proportionality constant to re-unify accessibility research with its Newtonian gravitational roots.

<!--To address our paper's aim: we referr to the gravity model of today (Wilson) as it is based in the same Newtonian gravitational analogy as accessibility as well as Paez et al. 2019 and Soukhov et al. 2023,2024 -->
The aim of this work is to demonstrate the importance of the proportionality constant consideration within @eq-3 to balancing the units of accessibility into an interpretable value thereby clarifying its meaning. To address this answer this question, we need not reinvent the wheel, instead we refer to the general gravity model of today (@eq-4) as introduced in @wilson1971. The gravity model traces back to these early 20th century empirical investigations [@carrothersHistoricalReviewGravity1956; @griggRavensteinLawsMigration1977; @haynesGravitySpatialInteraction1985; @oshanSpatialStructureDebate2021]; it also retains the proportionality constant and the resulting output is a tangible unit. 

$$
T_{ij} = k P_i^{\lambda} P_j^{\alpha} d_{ij}^{\beta}
$${#eq-4}

<!--Explain the features of the gravity model of today (Wilson) -->
Where $T_{ij}$ represents a $n$ x $m$ matrix of flows between $n$ origins $i$ and $m$ destinations $j$, $P$ are a vector of mass attributes at origin $i$ and $j$ and cost to overcome physical separation, and $d_{ij}$ is a $n$ x $m$ matrix. $d_{ij}$ is also frequently replaced by $f(c_{ij})$ in the literature, some function of $c_{ij}$ which decreases as $c_{ij}$ increases. Furthermore, the exponents are introduced to modulate the effect size of the variables, where $\lambda$ and $\alpha$ modulate $P$ and $\beta$ modulates $d$; when variables $T$, $P$ and $d$ are known, the exponents can be estimated to summarize the variable's effect size contribution to the known flows in the system. Finally and of most important note in this paper, $k$ is a scale parameter that makes the overall equation proportional to the rate characteristic of the modeled phenomenon. In other words, $T_{ij}$ explicitly measures _interaction_ as a unit of trips and the proportionality constant $k$ ensures the total sum of $T_{ij}$ represents the total flows in the data.

<!-- reiterate the paper's aim-->
This work aims to re-unify accessibility literature with its Newtonian roots by mapping it onto the family of gravity models. Not only to clarify accessibility's interpretation as a measure, but also to encourage future developments that draw from its physics roots, gravity modelling siblings, and spatial interaction history. We began by tracing the development of spatial interaction from @ravensteinLawsMigration1889 to it's split into accessibility research from @hansen1959 to today. In the following section, we will derive different types of accessibility measures, following the family of gravity models namely: non-constrained, constrained, unconstrained/Total constrained, singly constrained, composite singly constrained, doubly constrained. Then, we will provide empirical examples of the types of measures. Finally, we'll discuss the use of each measure and broadly the implications of ignoring the issue of proportionality in accessibility analysis.



# A family of accessibility measures

It's all about balancing factors! Lessons from the balancing factors of the gravity model (cool paper that explores this @kirbyNormalizingFactorsGravity1970)

Derive the various accessibility measures. In my mind:
•	Non-constrained: it does not include a single proportionality constant.

•	Unconstrained/Total constrained: uses a single proportionality constant

•	Singly constrained: spatial availability

Origins in retail models, decision model for shops to optimally spatially locate to max. their potential consumer interaction. Starting with reilly's law of gravitational retail (1931) (can't find online), formalized later in @huffDefiningEstimatingTrading1964 and @lakshmananRetailMarketPotential1965. 

Independently formed in people spatial interaction: "intervening opportunities and competing migrants" @stoufferInterveningOpportunitiesTheory1940 and @stoufferINTERVENINGOPPORTUNITIESCOMPETING1960, "axiomatically"  @weibull_axiomatic_1976, "for multiple-modes, as a rate" @shen1998;for multiple-modes, as the number of opportunities" @soukhovMultimodalSpatialAvailability2024

•	Composite singly constrained: Balanced floating catchment areas (not truly doubly constrained)

•	Doubly constrained (only when the units of the marginals are the same, therefore of more limited application)
ex. @hornerExploringMetropolitanAccessibility2004 and @allenMeasureCompetitiveAccess2020

# Examples

Use the TTS2016R package to illustrate every measure.

# Discussion

When to use each of these measures?

# Conclusions
