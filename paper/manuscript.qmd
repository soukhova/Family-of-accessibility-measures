---
title: "A family of accessibility measures"
format: pdf
bibliography: "`r system('kpsewhich ../bibliography/bibliography.bib', intern=TRUE)`"
nocite: |
  @careyPrinciplesSocialScience1858, @ravensteinLawsMigration1889, @ravensteinLawsMigration1885
---

```{r knitr-setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  cache = FALSE,
  warning = FALSE,
  message = FALSE,
  comment = '', 
  out.width = "1\\linewidth")
```

```{r load-packages, include=FALSE, cache=FALSE}
library(dplyr) # A Grammar of Data Manipulation
library(fitdistrplus) # Help to Fit of a Parametric Distribution to Non-Censored or Censored Data
library(geomtextpath) # Curved Text in 'ggplot2'
library(ggforce) # Accelerating 'ggplot2'
library(ggplot2) # Create Elegant Data Visualisations Using the Grammar of Graphics
library(ggpmisc) # Miscellaneous Extensions to 'ggplot2'
library(ggrepel) # Automatically Position Non-Overlapping Text Labels with 'ggplot2'
library(ggspatial) # Spatial Data Framework for ggplot2
library(gridExtra) # Miscellaneous Functions for "Grid" Graphics 
library(here)

# library(huxtable) # Easily Create and Style Tables for LaTeX, HTML and Other Formats
# library(kableExtra) # Construct Complex Table with 'kable' and Pipe Syntax
# library(patchwork) # The Composer of Plots
# library(RColorBrewer) # ColorBrewer Palettes
# library(sf) # Simple Features for R
# library(scales) # Scale Functions for Visualization
# library(shadowtext) # Shadow Text Grob and Layer
# library(skimr) # Compact and Flexible Summaries of Data
# library(spdep) # Spatial Dependence: Weighting Schemes, Statistics
# library(tidyr) # Tidy Messy Data
# library(tmap) # Thematic Maps
```

# Introduction

<!-- SUMMARY: Accessibility is related to mobility, however, institutionalized mobility-based transportation planning practice has treated accessibility as it's proxy. This has had problematic consequences. Conceptually, accessibility is a more complete and comprehensive evolution of mobility. As such, there has been recognition that the adoption of accessibility planning approaches are needed; however there are 1) too many definitions and 2) uncertainty in meaning of the outputs--> 
Accessibility is conceptually related to human mobility, it is often defined as the "potential of opportunities for interaction" [@hansen1959], opportunities such as places, events and social contacts that are important to people [@ferreiraReenactingMobilityAccessibility2020]. Accessibility adds a more comprehensive and complete understanding onto mobility, which simplify emphasizes the ability to move. However, the motivation of transportation planning has historically centered mobility and treated accessibility as its proxy, leading to problematic consequences [@handy2020]. In the rise of automobility-dominance, recent decades of mobility-based practice (e.g., highway expansion) have been marked by increased travel cost (time, effort, energy, financial cost) often not having an impact on accessibility levels [@handyACCESSIBILITYVSMOBILITYENHANCING2002]. In response, transportation planning practice has begin to adopt accessibility planning approaches, be it through the use of accessibility planning tools [@silvaAccessibilityInstrumentsPlanning2017] or through the traditional four-step transportation demand model [@ortuzar_2011_modelling]. However, institutional and conceptual barriers remain, many of which relate to the diversity of accessibility definitions [@handy2020] and tangible meaning of the outputs [@ferreiraReenactingMobilityAccessibility2020].

<!-- Considering population-level methods in transportation and city planning research, accessibility measures have been used to tackle a wide variety of research questions. They have taken on numerous definitions and analytical expressions; from simpler cumulative opportunities measures, to measures considering more complex travel behaviour and trip weighting characteristics, measures of _potential of opportunities for interaction_ are varied. Summarizing these definitions across studies have been challenging; a testament to these unsettled classifications are present in influential accessibility review literature [@handyMeasuringAccessibilityExploration1997; @geursAccessibilityEvaluationLanduse2004; @wuUnifyingAccess2020; @millerAccessibilityMeasurementApplication2018]. -->

<!-- PAPER'S AIM: improve interpretation of accessibility measure outputs. We do this by, 1) assuming accessibility is more complete understanding of mobiltiy, and connected them both mobility and accessibility are both based in the Netownian gravitational anology, lets introduce balancing factors like those  Gravity Model.   -->
In adopting the perspective that accessibility is an evolution of mobility conceptually, this paper aims to re-unify accessibility measures with its gravity-based Newtonian roots. It proposes to do so by mapping accessibility onto the family of gravity models. Not only to clarify accessibility's interpretation as a measure, but also to encourage future developments that draw from its physics roots, gravity modelling siblings, and spatial interaction history. We began by tracing the development of spatial interaction from @ravensteinLawsMigration1889 to it's split into accessibility research from @hansen1959 to today. In the following section, we will derive different types of accessibility measures, following the family of gravity models namely: non-constrained, constrained, unconstrained/Total constrained, singly constrained, composite singly constrained, doubly constrained. Then, we will provide empirical examples of the types of measures. Finally, we'll discuss the use of each measure and broadly the implications of ignoring the issue of proportionality in accessibility analysis.

# Background

## The inquiry into spatial interaction traces to Newton's Universal Gravitation
The patterns of people's movement in space have been a subject of scientific inquiry for centuries. From as far back as 1858 in Henry C. Carey's _Principles of Social Science_ where "man [is] the molecule of society [and their interaction is subject to] the direct ratio of the mass and the inverse one of distance" [@mckeanManual1883, pp. 37-38], investigations of how people interact in space has often been explicitly coloured by the features of Newton's Law of Universal Gravitation [posited in _Principia Mathematica_ of 1687 and expressed in @eq-grav-prop].

$$
F_{ij} \propto \frac{M_i M_j} {D_{ij}^{2}}
$${#eq-grav-prop}

@eq-grav-prop is one of the most famous equations in all of science, and it states that the force of attraction $F$ between a pair of bodies $i$ and $j$ is directly _proportional_ to the product of their masses $M_i$ and $M_j$, and inversely _proportional_ to the square of the distance between them $D_{ij}$. Direct proportionality only means that as the product of the masses increases, so does the force. Likewise, inversely proportional only means that as the distance increases, the force decreases. To quantify the magnitude of the force, an empirical factor is required to convert the proportionality into an equation, which ensures that the force $F$ matches empirical observations of the force of attraction between masses. Ultimately, the equation for the force is as seen in @eq-grav, where $G$ is a proportionality constant obtained empirically:

$$
F_{ij} = G \frac{M_i M_j} {D_{ij}^{2}}
$${#eq-grav}


## Early human spatial interaction research: from Ravenstein 1889 to Stewart 1948
<!-- SUMMARY: from the 1880s to the 1940s, researchers have theoretically and empirically attempted to characterise human spatial interaction as some force of attraction $F$ that is directly proportion to the masses $Mi$ and $Mj$ and inversely proportional by their separation distance. This concept was captured with different expressions, but all tie back to the same Newtonian gravity analogy. -->
Following Carey, research into human spatial interaction continued in different contexts. In 1885 and 1889, Ravenstein proposed his "Laws of Migration", based on his empirical analysis of migration flows in various countries [@ravensteinLawsMigration1885;@ravensteinLawsMigration1889]. In these works, Ravenstein posited a directly proportional relationship with the size of the destination (i.e., centres of commerce and industry), and an inversely proportional relationship between the size of flows and separation between origin and destination. These propositions are similar to Newton's gravitational laws. Over time, other researchers discovered similar relationships. <!--Rilley does not cite Newton, nor Carey, nor Ravenstein, but I removed this curiosity as it's not central to our point here--> For example, @reilly1929methods formulated a law of retail gravitation, expressed in terms of equal attraction to competing retail destinations. Later, Zipf proposed a $\frac{P_1P_2}{D}$ hypothesis for the case of goods movement by railways @zipfHypothesisCaseRailway1946, intercity personal movement @zipfHypothesisIntercityMovement1946,and information @zipfDeterminantsCirculationInformation1946. The $\frac{P_1P_2}{D}$ hypothesis stated that the magnitude of flows was proportional to the product of the populations of settlements, and inversely proportional to the distance between them. 

A common theme among these early researchers of human spatial interaction is that a proportionality constant similar to $G$ in @eq-grav is missing. Of the researchers cited, only Reilly and Zipf expressed their hypotheses in mathematical terms. Reilly's hypothesis was expressed as follows:
$$
B_a = \frac{(P_a\cdot P_T)^N}{D_{aT}^n}
$${#eq-reilly}

\noindent where $B_a$ is the amount of business drawn to $a$ from $T$, $P_a$ and $P_T$ are the populations of the two settlements, and $D_{aT}$ is the distance between them. Quantity $N$ was chosen by Reilly in a somewhat _ad hoc_ fashion as 1, and he used empirical observations of shoppers to choose a value of $n = 2$. 

Zipf, on the other hand, wrote his hypothesis in mathematical form as:
$$
C^2 = \frac{P_1\cdot P_2}{D}
$${#eq-zipf}

\noindent where $C$ is the volume of goods exchanged between $1$ and $2$, $P_1$ and $P_2$ are the populations of the two settlements, and  $D_{12}$ is the distance between them.

After Carey, it is in Stewart's [-@stewartDemographicGravitationEvidence1948] work on the principles of demographic gravitation that we find the strongest connection yet to Newton's law. We suspect that may relate to academic background; Stewart was a physicist, whereas Ravenstein, Reilly, and Zipf were social scientists. Besides awareness of preceding research, as he cites Reilly and Zipf as predecessors in the analysis of human spatial interaction, Stewart appears to have been the first author to express his theorized relationships for human spatial interaction with a proportionality constant $G$, as follows:

$$
F = G\frac{(N_1\mu_1)(N_2\mu_2)}{d_{12}^2}
$${#eq-stewart-force}

\noindent where:

- $F$ is the _demographic force_
- $N_1$ and $N_2$ are the numbers of people of in groups 1 and 2
- $\mu_1$ and $\mu_2$ are so-called _molecular weights_
- $d_{12}^2$ is the distance between $1$ and $2$
- And finally $G$, a constant that Stewart "left for future determination" [-@stewartDemographicGravitationEvidence1948, p. 34]

In addition to demographic force, Stewart defined a measure of "population potential" of $2$ with respect to $1$ as follows:
$$
V_1 = G\frac{M_2}{d}
$${#eq-stewart-population-potential}

For a system with more than 2 population bodies, Stewart formulated the population potential at $i$ as:
$$
V_i = \int\frac{D}{r} ds
$${#eq-stewart-population-potential-integral}

\noindent where $D$ is population density over an infinitesimal area $ds$, and $r$ is the distance to $i$. In more contemporary terms, this can be rewritten as:
$$
V_i = \sum_j \frac{M_j}{d_{ij}}
$${#eq-stewart-population-potential-sum}

\noindent which astute readers will identify as our modern definition of accessibility.

Stewart's formulation of demographic force, developed in the context of what he called "social physics" [@stewartPrinciples1947], was problematic. It had issues with inconsistent mathematical notation. For example, e.g., in @stewartDemographicGravitationEvidence1948, $G$ is used as a proportionality constant for both _demographic force_ and  _demographic energy_ on p. 34 <!--Antonio, is this what you meant?-->. And perhaps more seriously, it was permeated by a view of humans as particles, following physical laws, laws of which were afflicted by unmitigated racism. For instance, molecular weight $\mu$ was taken as one for the average American, but "presumably...much less than one....for an Australian aborigine" [p. 35]. Stewart's ideas about "social physics" fell out of favour among social scientists, but not before influencing the field of accessibility today. 

In summary: from the 1880s to the 1940s, researchers have theoretically and empirically attempted to characterise human spatial interaction as some force of attraction $F$ that is directly proportion to the masses $M$ of a pair of locations ($i$ and $j$) and inversely proportional by some sort of separation distance $D_{ij}$. Those that captured the relationship empirically, approached the concept with different expressions, some including a proportionality constant and some not, but all tying back to the Newtonian gravity analogy. 

## Hansen's gravity-based accessibility
<!-- SUMMARY: in Hansen's use of @stewartDemographicGravitationEvidence1948's Population Potential measure, we highlight two crucial omissions. 1) Stewart set the proportional constant $G$ to 1 _for future determination_, this constant is not explicitly addressed in @hansen1959 and accessibility continues to evolve without it. 2) Stewart suggests that keeping the exponent value of $d_ij$ as 1 is sufficient. In @hansen1959, an exponent other than 1 for $d_ij$ is selected based on empirical findings, however, the issue of _opportunity potential_ units are never addressed. -->

From @stewardDemographicGravitationEvidence1948, we arrive to Walter G. Hansen, the author of @hansen1959 which has been exceptionally influential in the accessibility literature. In this seminal paper @hansen1959, "accessibility is defined as the potential of opportunities for interaction" [p.73], it is "a generalization of the population-over-distance relationship or "population potential" concept developed by Stewart [@stewardDemographicGravitationEvidence1948]" [p.73], explicitly defined "as the potential of opportunities for interaction" [p.73]. As well as being a student of city and regional planning at Massachusetts Institute of Technology, Hansen was also an engineer with the the Bureau of Roads likely preoccupied with applied research that can be used to qualify transportation's power to shape land uses. @hansen1959 focused on @stewartDemographicGravitationEvidence1948's _population potential_ (expressed in (@eq-stewart-population-potential-sum)), leaving out Stewart's other formulaic contributions and objectionable aspects of "social physics". @hansen1959 recast @eq-stewart-population-potential-sum to reflect accessibility, a model of human behaviour useful in capturing regularities in mobility patterns . In this equation, @hansen1959 replaced $M_j$ with _opportunities_ to derive _opportunity potential_, or more accurately, _potential of opportunities for interaction_ as follows:
$$
S_{i} = \sum_j O_j \cdot d_{ij}^\beta \\
$${#eq-accessibility}

Alternatively, a more general form of this expression to account for different impedance functions:
$$
S_{i} = \sum_j O_j \cdot f(d_{ij})
$${#eq-accessibility-general}

$S_{i}$ in @eq-accessibility is is a relative measure of the accessibility at $i$, $O_j$ is the size of the activity at $j$ and $d_{ij}$ is the distance or travel time between $i$ and $j$ with $\beta$ describing the effect size. Today, Hansen is is frequently cited as the father of modern accessibility analysis due to his work in @hansen1959 [e.g., @reggianiGuestEditorialNew2011], and the Hansen-type accessibility is commonly referred to today as the gravity-based accessibility measure.

Of note, however is that between @stewartDemographicGravitationEvidence1948 and @hansen1959 the proportionality constant $G$ in @eq-grav vanished.  There is some evidence that @hansen1959 was aware of the importance of this constant as he wrote about _direct_ and _inversely proportional_ relationships between opportunities in one area, opportunities at another, and their separation distance. Furthermore, those reading @hansen1959 could consult @stewartDemographicGravitationEvidence1948 in which the proportionality constant $G$  was set to 1 and that "$G$ [was] left for future determination: a suitable choice of other units can reduce it to unity". 

## From Hansen-type accessibility to accessibility today
<!-- SUMMARY: accessibility from Hansen to today is very diverse and has a lack of concern for the interpretability of output units; likewise, a lack of concern for balancing units such as a proportionality constant.  Our answer: let's focus on those omitted (or implicit set to 1) proportionality constants.-->

Since @hansen1959, accessibility analysis has been widely employed across planning disciplines, but to our knowledge, developments have not been concerned with explicitly determining a proportionality constant $G$. $G$ continues to be implicitly set to $1$ even when the fundamental relationship in accessibility is proportionality (e.g., $ S_{i}  \propto G \sum_j O_j \cdot f(d_{ij})$ and not equality [for instance, see the formula for accessibility at the top of Figure 1 in @wuUnifyingAccess2020]. Without a proportionality constant, however, the units of $S_i$ remain unclear: the unit of 'potential of opportunity for interaction' is left free to change as $\beta$ is calibrated for the population center with no discussion of a constant to balance the units.

To overview recent accessibility literature development, the majority of studies develop on; the breath and geographic case study selection of the opportunity $O_j$ studied and potentially impacted population []; the accuracy of parameters that capture distance-decay $f(c_{ij})$ []; and additions to the opportunity $O_j$ attributes such as competitive demand considerations [@stoufferINTERVENINGOPPORTUNITIESCOMPETING1960; @weibull_axiomatic_1976; @shen1998; @allenMeasureCompetitiveAccess2020; @soukhovMultimodalSpatialAvailability2024]. Overall, due to the diverse range of questions accessibility measures have been applied to help clarify, a plethora of variations in @eq-accessibility-general are present in the literature. 

However, it has been raised that there is a difficulty in interpreting gravity-based accessibility's meaning as anything other than a relative index of potential interaction (higher accessibility/lower accessibility) []. This interpretation plagues this type of analysis, as implications beyond high-or-low access hotspots are often desired. What does the accessibility value mean? Difficultly in interpreting the output's tangible meaning contributes to resistance to its application in practice [@ferreiraReenactingMobilityAccessibility2020]. As reviewed, quantity and variations on @eq-accessibility-general also compounds the issue of interpretability across studies. 

A testament to this inconsistent interpretation are the unsettled classifications generated by influential review works of the accessibility literature; for instance, @handyMeasuringAccessibilityExploration1997 classifies studies into gravity- and utility-based measures, @geursAccessibilityEvaluationLanduse2004 introduces further classification by expanding categories into potential- (or gravity), utility-, location-, and person- based measures with different components. @wuUnifyingAccess2020 demonstrate that most or all of these concepts can be unified into its main features: the relationship between travel-cost and corresponding reachable opportunities. Indeed, these authors demonstrate how previous classifications are special cases of travel-cost or opportunities constraints. From the initial Newtonian analogy, we interpret @wuUnifyingAccess2020's work as offering a positive contribution by circling back to re-unify mass $M$ and separation distance $D$; however, an important component is still missing, the proportionality constant $G$. 

The aim of this paper's focus is on the proportionality constant. We wish to demonstrate the importance of transiting from proportionality to equality in @eq-accessibility-general, in order to balance the units of accessibility into more interpretable values with clear meanings. To address this matter, we need not reinvent the wheel: instead we refer to the spatial interaction model as developed by @wilson1971. In essence, in what follows, we reunite the accessibility indicators literature with the spatial interaction literature as developed by @wilson1971 based on entropy maximization concepts. Although Wilson's approach is based on a different conceptual foundation than the old reference to Newtonian gravity, the work succeeded at identifying the steps from proportionality to equality to yield variations of proportionality constants: including the one that eluded @stewartDemographicGravitationEvidence1948 and has been ignored in almost all subsequent accessibility research.

# Gravity-based accessibility's sibling: the gravity model

Today's gravity-based accessibility measure (@eq-accessibility-general) share the same early 20th century Newtonian-based  origins as the gravity model, the most widely used model in the study of spatial interaction [@ortuzar_2011_modelling;@wilson1971]. However, in some ways the gravity model and spatial interaction continued to evolve independently from @eq-accessibility-general, the former being developed into formalized transportation demand modelling practice to 'predict-and-provide', and the later taken up to describe land-use and transportation interactions by geography and social science- adjacent researchers and planners. <!-- Antonio, this is my sense at this point..?-->

There are plenty of insights to be shared across these sibling branches; they are both spatial interaction models From the perspective of gravity-based accessibility measure, this paper's focus is on the proportionality constant of the classic gravity model, which takes the following form: 
 
$$
T_{ij} = k O_i D_j f(c_{ij})
$${#eq-gravity-model}

<!--Explain the features of the gravity model of today (Wilson) -->
Where $T_{ij}$ represents a $n$ x $m$ matrix of flows between an $n$ number of origins $i$ and an $m$ number of destinations $j$, $O_i$ and $D_j$ is a vector of mass attributes representing origin $i$ and destination $j$ respectively, and $f(c_{ij})$ is a $n$ x $m$ matrix representing some function of travel cost $c_{ij}$ which reflects travel impedance. In other words, $T_{ij}$ explicitly measures _interaction_ as a unit of trips and the single proportionality constant $k$ ensures the total sum of $T_{ij}$ represents the total flows in the data. It should be noted that the early analogy with the gravitational law proved too simplistic, and improvements to the gravity model (@eq-gravity-model) are the use of total trip ends (number of originating trips from zone $i$ are $O_i$ and ending trips at zone $j$ are $D_j$) instead of total populations and separation distance calibrated by a power $n$ (such as $P_i$, $P_j$, and $n$ in @eq-zipf, @eq-reilly and @eq-stewart-force). Finally, and of most important note in this paper, $k$ is a scale parameter that makes the overall equation proportional to the rate characteristic of the modeled phenomenon.

Traditionally, the development of the gravity model has put an emphasis on the interpretability of the resulting units [@kirbyNormalizingFactorsGravity1970; @wilsonSTATISTICALTHEORYSPATIAL1967;@wilson1971]. As such, @eq-gravity-model can take account of any additional information that can be built into the model to constrain the _interaction_ variable $T_{ij}$. As mentioned, $T_ij$ is in the unit of trips, so additional knowledge can be the total trip flows $O_i$ originating at each $i$ and the total trip flows $D_j$ terminating at $j$. These pieces of information can constrain $T_{ij}$ as follows, ensuring it reflects this knowledge:

$$
\sum_j T_{ij} = O_i
$${#eq-constraint1-gravitymodel}

$$
\sum_i T_{ij} = D_j
$${#eq-constraint2-gravitymodel}

Using these constraints, the gravity model @eq-gravity-model is typically distinguished in four cases, cases that are mathematically and conceptually consistent, so they have continued to be useful in classifying the gravity model in trip distribution modelling to this day [@ortuzar_2011_modelling]: 

- neither @eq-constraint1-gravitymodel or @eq-constraint2-gravitymodel hold -- the unconstrained case;
- @eq-constraint1-gravitymodel holds -- the production constrained case (origin-constrained, a singly-constrained case); 
- @eq-constraint2-gravitymodel holds -- the attraction constrained case (destination-constrained, a singly-constrained case); 
- @eq-constraint1-gravitymodel and @eq-constraint2-gravitymodel both hold simultaneously -- the production-attraction constrained case (doubly-constrained).

In each of these four cases, the single proportionality constant $k$ is replaced by two sets of balancing factors $A_i$ and $B_j$ to ensure the case-specific constraints are satisfied. For the doubly-constrained case:  
$$
T_{ij} = A_i O_i B_j D_j f(c_{ij})
$${#eq-doublyconstrained-gravitymodel}

And the balancing factors equal:
$$
A_i = \frac{1}{\sum_j B_j D_j f(c_{ij})}
$${#eq-bf-A-gravitymodel}

$$
B_j = \frac{1}{\sum_j A_i O_j f(c_{ij})}
$${#eq-bf-B-gravitymodel}

For the singly-constrained cases, origin-constrained case replaces $B_j$ with 1 for all $j$ and $A_i$ is @eq-bf-A-gravitymodel, and the the destination-constrained case replaces $A_i$ with 1 for all $i$ and $B_j$ is @eq-bf-B-gravitymodel. In a way, the singly-constrained and doubly-constrained cases are variants of the unconstrained case.

## Entropy maximising: the gravity-model as statistical averages
Instead of the Newtonian gravity analogy, entropy maximisation is a popular model building approach taken in the spatial interaction studies to generate the gravity model. Namely, it is mathetmatically regorouse and offers a sensible interpretation of the resulting mode as a statistical averaging procedure. This allows the measure to be effective in describing behaviour in large populations but less effective in smaller decision making units in the region of interest.

The basis of the approach is to accept that there are macro, meso, and micro states -- where all micro states that are consistent with our information about macro states are equally likely to occur. For the _interaction_ variable of trips $T_{ij}$, as shown in @wilson1971, the number of micro states $W\{{T_{ij}}\}$ within a meso state $T_{ij}$ can be expressed as:
$$ 
W\{{T_{ij}}\} = \frac{T!}{\prod_{ij}T_{ij}!}
$${#eq-micro-meso-states}
<!--I LEFT OUT THE DERIVATION... NOT SURE IF ITS NECESSARY? -->
Using the maximizing entropy approach, we must find a set of $T_{ij}$ that maximizes @eq-micro-meso-states subject to our sensible macro-state constraints @eq-constraint1-gravitymodel, @eq-constraint1-gravitymodel and the following on total cost $C$ constraint:
$$
\sum_{ij}T_{ij}c_{ij} = C
$${#eq-constraint3-gravitymodel}

The natural logarithm of @eq-micro-meso-states is maximized under @eq-constraint1-gravitymodel, @eq-constraint1-gravitymodel and @eq-constraint3-gravitymodel for mathematical convenience, as both $ln W$ and $T_{ij}$ share the same maximum [@wilson1971; @ortuzar_2011_modelling]. The result is:

$$
T_{ij} = A_i O_i B_j D_j exp(-\beta c_{ij})
$${#eq-maxentropy-gravitymodel}

Where,
$$
A_i = \frac{1}{\sum_j B_j D_j  \exp(- \beta c_{ij})}
$${#eq-bf-maxentropy-A-gravitymodel}

and
$$
B_j = \frac{1}{\sum_j A_i O_j  \exp(- \beta c_{ij})}
$${#eq-bf-maxentropy-B-gravitymodel}

Results of maximisation are identical to @eq-doublyconstrained-gravitymodel, @eq-bf-A-gravitymodel, and @eq-bf-B-gravitymodel except the general $f(c_{ij})$ is $exp(-\beta c_{ij})$. From this approach, the gravity model can be interpretted to say that given the total number of individual trips (micro level) statistically represented at origin and destination zones (meso level), the cost of travelling (micro level, represented at the meso level), and the fixed total cost of travelling in the region (number of trips and cost of travel at the macro level). There is then a most probable distribution of trips between zones (meso-states) that stasify all the macro-state constraints.

# A family of accessibility measures

Referring to the preceding section, the entropy maximizing method can be used to derive an equivalent family of measures, but for the case of accessibility where the _interaction_ variable is $V_{ij}$, represent _potential interaction_, i.e., the number of potential reachable opportunities. $T_{ij}$ in @eq-gravity-model can be replaced with $V_{ij}$ and presented as follows: 

$$
V_{ij} = k O_i D_j f(c_{ij})
$${#eq-access}

Where $V_{ij}$ represents a $n$ x $m$ matrix of potential reachable opportunities between an $n$ number of origins $i$ and an $m$ number of destinations $j$, $O_i$ and $D_j$ is a vector of mass attributes representing origin $i$ and destination $j$ respectively, and $f(c_{ij})$ is a $n$ x $m$ matrix representing some function of travel cost $c_{ij}$ which reflects travel impedance. In other words, $V_{ij}$ explicitly measures _potential interaction_ as a unit of number of potentially reachable opportunities and the single proportionality constant $k$ ensures the total sum of $V_{ij}$ represents the total potential reachable opportunities in the data. Finally, and of most important note in this paper, $k$ is a scale parameter that makes the overall equation proportional to the rate characteristic of the modeled phenomenon.

Like with @eq-gravity-model, we distinguish @eq-access into FIVE cases based on versions of the gravity-model building constraints (@eq-constraint1-gravitymodel,  @eq-constraint2-gravitymodel, and @eq-constraint3-gravitymodel). To inform each case of @eq-access with constraints that reflect knowledge of the macro-state, the total trip flow $O_i$ originating at each $i$ and the total trip flows $D_j$ terminating at $j$ are used. These pieces of information can constrain $V_{ij}$ as follows, ensuring it reflects this macro-level knowledge, i.e., the sum of the number of potential reachable opportunities. 

$$
\sum_j V_{ij} = O_i
$${#eq-constraint1-access}
\noindent Where sum of all potentially reachable opportunities for all $j$ zones in the region is equal to the opportunities originating $O_i$ at each $i$ in the region.

$$
\sum_i V_{ij} = D_j
$${#eq-constraint2-access}
\noindent Where sum of all potentially reachable opportunities for all $i$ zones in the region is equal to the opportunities ending $D_i$ at each $j$ in the region.

$$
\sum_{i}\sum_{j} V_{ij} c_{ij} = C
$${#eq-constraint3-access}
\noindent Where the sum of the travel cost of each potentially reached opportunity in the region is equal to a total travel cost $C$.

For all FIVE cases, @eq-constraint3-access holds <!--in the event C is known, it could be used to identify parameters in f(c_ij)... though model calibration is probably a better idea. --> but are differentiated like:
- neither @eq-constraint1-access or @eq-constraint2-access hold -- the unconstrained case;
- @eq-constraint1-access holds -- the production constrained case (origin-constrained, a singly-constrained case); 
- @eq-constraint2-access holds -- the attraction constrained case (destination-constrained, a singly-constrained case); 
- @eq-constraint1-access and @eq-constraint2-access both hold simultaneously -- the production-attraction constrained case (doubly-constrained).
- @eq-constraint1-access or @eq-constraint2-access partly hold -- hybrid production constrained case <!-- (could be repeated for attraction constrained case... and doubly constrained case)-->

Using the maximizing entropy approach... <!--DESCRIBING WHAT EACH MICRO/MESO/MACRO STATE IS HERE IN RELATION TO ACCESSIBILITY--> For each case...

## Unconstrained case

Neither @eq-constraint1-access or @eq-constraint2-access hold, so $V_ij'$ has no opportunity constraints!  

$$
V_{ij}' = k O_i D_j f(c_{ij})
$${#eq-access-unconstrained}

Where $k$ is two sets of balancing factors, $A_i'$ and $B_j'$, and both are equal to 1. 


## Singly-constrained case (origin-constrained)

Spatial availability; origin-constrained. 

Origins in human spatial interaction: "intervening opportunities and competing migrants" @stoufferInterveningOpportunitiesTheory1940 and @stoufferINTERVENINGOPPORTUNITIESCOMPETING1960, "axiomatically"  @weibull_axiomatic_1976, "for multiple-modes, as a rate" @shen1998; for multiple-modes, as the number of opportunities" @soukhovMultimodalSpatialAvailability2024

$$
V_{ij}'' = k O_i D_j f(c_{ij})
$${#eq-access-singlyconstrained}

<!--HOW DO WE FIT OUR EXISTING CONSTRAINTS INTO THESE BALANCING FACTORS..? $k O_i f(c_{ij}) = the balancing factors..?-->
$$
V_{ij}'' = O_j\frac{F^p_{ij} \cdot F^c_{ij}}{\sum_{i=1}^K F^p_{ij} \cdot F^c_{ij}}
$$
Population balancing factor:
$$
F^p_{ij} = \frac{P_{i\in r}^\alpha}{\sum_{i=1}^K P_{i\in r}^\alpha}
$$
Travel cost balancing factor:
$$
F^c_{ij} = \frac{f(c_{ij})}{\sum_{i=1}^K f(c_{ij})}
$$
## Singly-constrained case (destination-constrained)

Origins are in retail models, decision model for shops to optimally spatially locate to max. their potential consumer interaction. Starting with reilly's law of gravitational retail (1931), formalized later in @huffDefiningEstimatingTrading1964 and @lakshmananRetailMarketPotential1965. Spatial availability as another example.

## Doubly constrained case (origin-destination constrained)

(only when the units of the marginals are the same, therefore of more limited application)
ex. @hornerExploringMetropolitanAccessibility2004 and @allenMeasureCompetitiveAccess2020


## Hybrid singly-constrained case: 
<!--NOTE TO SELF: where does E2SFCA and 3SFCA fit??-->
Balanced floating catchment areas (not truly doubly constrained)

# Empirical examples

Use the TTS2016R package to illustrate every measure.

# Discussion

When to use each of these measures?

# Conclusions


# References

<!--the benefits of this formulation, and the inclusion of the propoartionality constant has been imense for spatial interaction modelling. For instance, the identification of the conovlution of spatial autocorrelation and and distance-decay @griffithSpatialStructureSpatial2007 -->

<!-- Wilson in @wilsonSTATISTICALTHEORYSPATIAL1967 was the first to connect accessibility measures to balancing factors-->

<!--
@wilson1971 (pg. 28) summarises the following checklist for spatial interaction model builders:
1. Nature of the spatial interaction variable; 
2. Nature of the mass terms
3. Measurement of mass terms
4. Measurement of interaction cost
5. Choice of cost function
6. Other terms
7. Design of spatial system
8. Calibration
9. Relation to general model framework
-->

<!-- (cool paper that explores this @kirbyNormalizingFactorsGravity1970 - he "shows that the Ai and Bj balancing factors are the mean values of the inverse of the function e^-N*F(c_ij) calculated by summing the function over i values for Ai factors and over j values for Bj factors." -->
