---
title: "A family of accessibility measures"
format: pdf
bibliography: "`r system('kpsewhich ../bibliography/bibliography.bib', intern=TRUE)`"
---

```{r knitr-setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  cache = FALSE,
  warning = FALSE,
  message = FALSE,
  comment = '', 
  out.width = "1\\linewidth")
```

```{r load-packages, include=FALSE, cache=FALSE}
library(dplyr) # A Grammar of Data Manipulation
library(fitdistrplus) # Help to Fit of a Parametric Distribution to Non-Censored or Censored Data
library(geomtextpath) # Curved Text in 'ggplot2'
library(ggforce) # Accelerating 'ggplot2'
library(ggplot2) # Create Elegant Data Visualisations Using the Grammar of Graphics
library(ggpmisc) # Miscellaneous Extensions to 'ggplot2'
library(ggrepel) # Automatically Position Non-Overlapping Text Labels with 'ggplot2'
library(ggspatial) # Spatial Data Framework for ggplot2
library(gridExtra) # Miscellaneous Functions for "Grid" Graphics 
library(here)

# library(huxtable) # Easily Create and Style Tables for LaTeX, HTML and Other Formats
# library(kableExtra) # Construct Complex Table with 'kable' and Pipe Syntax
# library(patchwork) # The Composer of Plots
# library(RColorBrewer) # ColorBrewer Palettes
# library(sf) # Simple Features for R
# library(scales) # Scale Functions for Visualization
# library(shadowtext) # Shadow Text Grob and Layer
# library(skimr) # Compact and Flexible Summaries of Data
# library(spdep) # Spatial Dependence: Weighting Schemes, Statistics
# library(tidyr) # Tidy Messy Data
# library(tmap) # Thematic Maps
```

# Introduction

<!-- SUMMARY: Accessibility is related to mobility, however, institutionalized mobility-based transportation planning practice has treated accessibility as it's proxy. This has had problematic consequences. Conceptually, accessibility is a more complete and comprehensive evolution of mobility. As such, there has been recognition that the adoption of accessibility planning approaches are needed; however there are 1) too many definitions and 2) uncertainty in meaning of the outputs--> 
Accessibility, a central concept in transport geography, planning, and engineering, is conceptually related to human mobility and the opportunity landscape. In simple terms, it is defined as the "potential of opportunities for interaction" [@hansen1959]. The range of opportunities considered in accessibility analysis has grown to include <!-- --> employment [REFS], health care [REFS], green spaces [REFS], schools [REFS], social contacts [REFS], emergency services [e.g., shelters, REFS], and many more. In other words, accessibility analysis is today used to understand the potential to reach opportunities that are important to people [@ferreiraReenactingMobilityAccessibility2020]. Compared to earlier measures of performance used in transportation (e.g., VKT, PKT, etc.) that benchmark the amount of movement, accessibility brings a more holistic understanding of transportation and land use systems combined [@handyMeasuringAccessibilityExploration1997]. However, the focus of transportation planning has historically prioritized mobility and treated accessibility as a by-product of movement, leading to problematic consequences [@handy2020]. With the rise of an automobility mono-culture [@miller_collaborative_2011; @lavery_driving_2013], recent decades of mobility-based practice (e.g., road and highway expansion) have been marked by increased travel cost (time, effort, energy, financial cost), often with limited impact on accessibility levels [e.g., @handyACCESSIBILITYVSMOBILITYENHANCING2002; @paez_healthcare_2010]. In response, transportation planning practice has begin to adopt accessibility planning approaches, via accessibility planning tools [@silvaAccessibilityInstrumentsPlanning2017; @paez_developing_2013] or through the traditional four-step transportation demand model [@ortuzar_2011_modelling]. However, institutional and conceptual barriers remain, many of which relate to the diversity of accessibility definitions [@handy2020] and interpretability and communicability of the outputs [@geurs2004; @ferreiraReenactingMobilityAccessibility2020].

<!-- Considering population-level methods in transportation and city planning research, accessibility measures have been used to tackle a wide variety of research questions. They have taken on numerous definitions and analytical expressions; from simpler cumulative opportunities measures, to measures considering more complex travel behaviour and trip weighting characteristics, measures of _potential of opportunities for interaction_ are varied. Summarizing these definitions across studies have been challenging; a testament to these unsettled classifications are present in influential accessibility review literature [@handyMeasuringAccessibilityExploration1997; @geursAccessibilityEvaluationLanduse2004; @wuUnifyingAccess2020; @millerAccessibilityMeasurementApplication2018]. -->

<!-- PAPER'S AIM: improve interpretation of accessibility measure outputs. We do this by, 1) assuming accessibility is more complete understanding of mobiltiy, and connected them both mobility and accessibility are both based in the Netownian gravitational anology, lets introduce balancing factors like those  Gravity Model.   -->
In adopting the perspective that accessibility is an evolution of mobility conceptually, this paper aims to re-unify accessibility measures with its spatial interaction-based roots. It proposes to do so by mapping accessibility onto Wilson's family of spatial interactions models [@wilson1971]. In this, we aim not only to clarify accessibility's interpretation as a measure of performance, but also to encourage future developments that draw from its gravity modelling siblings, and spatial interaction history. To this end, we begin by tracing the development of spatial interaction from @ravensteinLawsMigration1889 to its split into accessibility research from @hansen1959 to today. After this, we derive different types of accessibility measures, following the family of gravity models namely: unconstrained, total constrained, origin- and destination- constrained, composite destination-constrained, and doubly constrained. Then, we will provide empirical examples of the types of measures. Finally, we will discuss the use of each measure and broadly the implications of ignoring the role of constrains in accessibility analysis.

# Background

## The inquiry into spatial interaction traces to Newton's Universal Gravitation

The patterns of people's movement in space have been a subject of scientific inquiry for centuries. From as far back as Henry C. Carey's _Principles of Social Science_ [@careyPrinciplesSocialScience1858] there was already a concern with the scientific study of human interaction over space. It is in this work where Carey states that "man [is] the molecule of society [and their interaction is subject to] the direct ratio of the mass and the inverse one of distance" [@mckeanManual1883, pp. 37-38], which shows how investigations into human spatial interaction have often been explicitly coloured by the features of Newton's Law of Universal Gravitation [posited in _Principia Mathematica_ of 1687 and expressed in @eq-phys-grav-prop].

$$
F_{ij} \propto \frac{M_i M_j} {D_{ij}^{2}}
$${#eq-phys-grav-prop}

To be certain, the expression above, a proportionality, is one of the most famous in all of science. In brief, it states that the force of attraction $F$ between a pair of bodies $i$ and $j$ is directly _proportional_ to the product of their masses $M_i$ and $M_j$, and inversely _proportional_ to the square of the distance between them $D_{ij}$. Direct proportionality only means that as the product of the masses increases, so does the force. Likewise, inverse proportionality only means that as the distance increases, the force decreases. To quantify the magnitude of the force, an empirical factor, say $G$, is required to convert the proportionality into an equality, which ensures that the force $F$ matches empirical observations of the force of attraction between masses. Ultimately, the equation for the force is as seen in @eq-phys-grav, where $G$ is a proportionality constant obtained empirically:

$$
F_{ij} = G \frac{M_i M_j} {D_{ij}^{2}}
$${#eq-phys-grav}

Newton's initial estimate of $G$ was based on a speculation that the mean density of earth was between five or six times that of water, an assumption that Hutton's experiments of 1778 validated [@hutton_xxxiii_1778, p. 783]. Still, it took over a century from the publication of _Principia_ to refine the estimate of this constant to within 1\% accuracy, with Cavendish's 1798 experiment [@cavendish_xxi_1798].

## Early research on human spatial interaction: from Ravenstein (1889) to Stewart (1948)

<!-- SUMMARY: from the 1880s to the 1940s, researchers have theoretically and empirically attempted to characterise human spatial interaction as some force of attraction $F$ that is directly proportion to the masses $Mi$ and $Mj$ and inversely proportional by their separation distance. This concept was captured with different expressions, but all tie back to the same Newtonian gravity analogy. -->
Following Carey's _Principles_ of 1858, research into human spatial interaction continued in different contexts. In the late 1880s Ravenstein proposed his "Laws of Migration", based on his empirical analysis of migration flows in various countries [@ravensteinLawsMigration1885; @ravensteinLawsMigration1889]. In these works, Ravenstein posited a directly proportional relationship of migration flows with the size of the destination (i.e., centres of commerce and industry), and an inversely proportional relationship between the size of flows and separation between origin and destination. These propositions are similar to Newton's gravitational laws. Over time, other researchers discovered similar relationships. <!--Rilley does not cite Newton, nor Carey, nor Ravenstein, but I removed this curiosity as it's not central to our point here--> For example, @reilly1929methods formulated a law of retail gravitation, expressed in terms of equal attraction to competing retail destinations. Later, Zipf proposed a $\frac{P_1P_2}{D}$ hypothesis for the case of goods movement by railways @zipfHypothesisCaseRailway1946, intercity personal movement @zipfHypothesisIntercityMovement1946,and information @zipfDeterminantsCirculationInformation1946. The $\frac{P_1P_2}{D}$ hypothesis stated that the magnitude of flows was proportional to the product of the populations of settlements, and inversely proportional to the distance between them. 

A common theme among these early researchers of human spatial interaction is that a proportionality constant similar to $G$ in @eq-phys-grav is missing. Of the researchers cited, only Reilly and Zipf expressed their hypotheses in mathematical terms. Reilly's hypothesis was expressed as follows:
$$
B_a = \frac{(P_a\cdot P_T)^N}{D_{aT}^n}
$${#eq-reilly}

\noindent where $B_a$ is the amount of business drawn to $a$ from $T$, $P_a$ and $P_T$ are the populations of the two settlements, and $D_{aT}$ is the distance between them. Quantity $N$ was chosen by Reilly in a somewhat _ad hoc_ fashion as 1, and he used empirical observations of shoppers to choose a value of $n = 2$. 

Zipf, on the other hand, wrote his hypothesis in mathematical form as:
$$
C^2 = \frac{P_1\cdot P_2}{D}
$${#eq-zipf}

\noindent where $C$ is the volume of goods exchanged between $1$ and $2$, $P_1$ and $P_2$ are the populations of the two settlements, and  $D_{12}$ is the distance between them.

After Carey, it is in Stewart's work on the principles of demographic gravitation that we find the strongest connection yet to Newton's law [@stewartDemographicGravitationEvidence1948]. We suspect that this may relate to academic backgrounds; Stewart was a physicist, whereas Ravenstein, Reilly, and Zipf were social scientists. Besides awareness of preceding research, as he cites Reilly and Zipf as predecessors in the analysis of human spatial interaction, Stewart appears to have been the first author to express his theorized relationships for human spatial interaction with a proportionality constant $G$, as follows:
$$
F = G\frac{(N_1\mu_1)(N_2\mu_2)}{d_{12}^2}
$${#eq-stewart-force}

\noindent where:

- $F$ is the _demographic force_
- $N_1$ and $N_2$ are the numbers of people of in groups 1 and 2
- $\mu_1$ and $\mu_2$ are so-called _molecular weights_
- $d_{12}^2$ is the distance between $1$ and $2$
- And finally $G$, a constant that Stewart "left for future determination" [-@stewartDemographicGravitationEvidence1948, p. 34]

In addition to demographic force, Stewart defined a measure of "population potential" of $2$ with respect to $1$ as follows:
$$
V_1 = G\frac{M_2}{d}
$${#eq-stewart-population-potential}

For a system with more than 2 population bodies, Stewart formulated the population potential at $i$ as:
$$
V_i = \int\frac{D}{r} ds
$${#eq-stewart-population-potential-integral}

\noindent where $D$ is population density over an infinitesimal area $ds$, and $r$ is the distance to $i$. In more contemporary terms, this can be rewritten as:
$$
V_i = \sum_j \frac{M_j}{d_{ij}}
$${#eq-stewart-population-potential-sum}

\noindent which astute readers will identify as our modern definition of accessibility.

Stewart's formulation of demographic force, developed in the context of what he called "social physics" [@stewartPrinciples1947], was problematic. It had issues with inconsistent mathematical notation. For example, e.g., in @stewartDemographicGravitationEvidence1948, $G$ is used as a proportionality constant for both _demographic force_ and  _demographic energy_ on p. 34 <!--Antonio, is this what you meant?-->. Perhaps more seriously, Stewart's work was permeated by a view of humans as particles following physical laws, but with ideas that were afflicted by unscientific racism. For instance, the molecular weight $\mu$ was presumed to be one for the average American, but "presumably...much less than one....for an Australian aborigine" [p. 35]. Stewart's ideas about "social physics" fell out of favour among social scientists, but not before influencing the emerging field of accessibility research.

In summary: from the 1850s to the 1940s, researchers attempted to theoretically and empirically characterise human spatial interaction as some force of attraction $F$ that is directly proportion to the masses $M$ of a pair of locations ($i$ and $j$) and inversely proportional by some sort of separation distance $D_{ij}$. Those that captured the relationship empirically, approached the concept with different expressions, some including a proportionality constant and some not, but all tying back to the Newtonian gravity analogy. 

## Hansen's gravity-based accessibility
<!-- SUMMARY: in Hansen's use of @stewartDemographicGravitationEvidence1948's Population Potential measure, we highlight two crucial omissions. 1) Stewart set the proportional constant $G$ to 1 _for future determination_, this constant is not explicitly addressed in @hansen1959 and accessibility continues to evolve without it. 2) Stewart suggests that keeping the exponent value of $d_ij$ as 1 is sufficient. In @hansen1959, an exponent other than 1 for $d_ij$ is selected based on empirical findings, however, the issue of _opportunity potential_ units are never addressed. -->

From @stewartDemographicGravitationEvidence1948, we arrive to 1959 and Walter G. Hansen, whose work proved to be exceptionally influential in the accessibility literature [@hansen1959]. In his seminal paper, Hansen defined accessibility, i.e., "the potential of opportunities for interaction" [p.73], as "a generalization of the population-over-distance relationship or 'population potential' concept developed by Stewart [@stewartDemographicGravitationEvidence1948]" [p.73]. As well as being a student of city and regional planning at Massachusetts Institute of Technology, Hansen was also an engineer with the the Bureau of Roads, and likely preoccupied with applied research into the power of transportation to shape land uses. @hansen1959 focused on @stewartDemographicGravitationEvidence1948's _population potential_ (expressed in @eq-stewart-population-potential-sum), leaving Stewart's other formulaic contributions and objectionable aspects of "social physics" behind. @hansen1959 recast @eq-stewart-population-potential-sum to reflect accessibility, a model of human behaviour useful to capture regularities in mobility patterns . In this equation, @hansen1959 replaced $M_j$ with _opportunities_ to derive an _opportunity potential_, or more accurately, a _potential of opportunities for interaction_ as follows:
$$
S_{i} = \sum_j O_j \cdot d_{ij}^\beta \\
$${#eq-accessibility}

Alternatively, a more general form of this expression to account for different impedance functions:
$$
S_{i} = \sum_j O_j \cdot f(d_{ij})
$${#eq-accessibility-general}

$S_{i}$ in @eq-accessibility is a measure of the accessibility at $i$, whereas $O_j$ is the size of the activity at $j$ and $d_{ij}$ is the distance or travel time between $i$ and $j$ with $\beta$ describing the effect size. Today, Hansen is is frequently cited as the father of modern accessibility analysis [e.g., @reggianiGuestEditorialNew2011], and Hansen-type accessibility is commonly referred to today as the gravity-based accessibility measure.

Of note, however is that between @stewartDemographicGravitationEvidence1948 and @hansen1959 the proportionality constant $G$ in @eq-stewart-population-potential vanished. There is some evidence that @hansen1959 was aware of the importance of this constant as he wrote about _direct_ and _inversely proportional_ relationships between opportunities in one area, opportunities at another, and their separation distance. Furthermore, those reading @hansen1959 should remember that @stewartDemographicGravitationEvidence1948 set the proportionality constant $G$  to 1, with a note that"$G$ [was] left for future determination: a suitable choice of other units can reduce it to unity". 

## From Hansen-type accessibility to accessibility today
<!-- SUMMARY: accessibility from Hansen to today is very diverse and has a lack of concern for the interpretability of output units; likewise, a lack of concern for balancing units such as a proportionality constant.  Our answer: let's focus on those omitted (or implicit set to 1) proportionality constants.-->

Since @hansen1959, accessibility analysis has been widely employed across planning disciplines [CITE MAJOR REVIEWS OVER LAST 30 YEARS]. However, to our knowledge, the proportionality constant has remained forgotten, with no notable developments to explicitly determining it. In this way, $G$ continues to be implicitly set to $1$ even when the fundamental relationship in accessibility is proportionality (e.g., $ S_{i}  \propto G \sum_j O_j \cdot f(d_{ij})$ and not equality [for instance, see the formula for accessibility at the top of Figure 1 in @wuUnifyingAccess2020]. Without a proportionality constant, however, the units of $S_i$ remain unclear: the unit of 'potential of opportunity for interaction' is left free to change as $\beta$ is calibrated for the population center with no discussion of a constant to balance the units.

To overview recent accessibility literature development, the majority of studies develop on; the breath and geographic case study selection of the opportunity $O_j$ studied and potentially impacted population []; the accuracy of parameters that capture distance-decay $f(c_{ij})$ []; and additions to the opportunity $O_j$ attributes such as competitive demand considerations [@stoufferINTERVENINGOPPORTUNITIESCOMPETING1960; @weibull_axiomatic_1976; @shen1998; @allenMeasureCompetitiveAccess2020; @soukhovMultimodalSpatialAvailability2024]. Overall, due to the diverse range of questions accessibility measures have been applied to help clarify, a plethora of variations in @eq-accessibility-general are present in the literature. 

However, it has been raised that there is a difficulty in interpreting gravity-based accessibility's meaning as anything other than a relative index of potential interaction (higher accessibility/lower accessibility) []. Interpretability issues plague this type of analysis, as implications beyond high-or-low access hotspots are often desired. What does the accessibility value mean? Difficultly in interpreting the output's tangible meaning contributes to resistance to its application in practice [@ferreiraReenactingMobilityAccessibility2020]. As reviewed, quantity and variations on @eq-accessibility-general also compounds the issue of interpretability across studies. 

A testament to this inconsistent interpretation are the unsettled classifications generated by influential review works of the accessibility literature; for instance, @handyMeasuringAccessibilityExploration1997 classifies studies into gravity- and utility-based measures, @geursAccessibilityEvaluationLanduse2004 introduces further classification by expanding categories into potential- (or gravity), utility-, location-, and person- based measures with different components. @wuUnifyingAccess2020 demonstrate that most or all of these concepts can be unified into its main features: the relationship between travel-cost and corresponding reachable opportunities. Indeed, these authors demonstrate how previous classifications are special cases of travel-cost or opportunities constraints. From the initial Newtonian analogy, we interpret @wuUnifyingAccess2020's work as offering a positive contribution by circling back to re-unify mass $M$ and separation distance $D$; however, an important component is still missing, the proportionality constant $G$. 

The aim of this paper's focus is on the proportionality constant. We wish to demonstrate the importance of transiting from proportionality to equality in @eq-accessibility-general, in order to balance the units of accessibility into more interpretable values with clear meanings. To address this matter, we need not reinvent the wheel: instead we refer to the spatial interaction model as developed by @wilson1971. In essence, in what follows, we reunite the accessibility indicators literature with the spatial interaction literature as developed by @wilson1971 based on entropy maximization concepts. Although Wilson's approach is based on a different conceptual foundation than the old reference to Newtonian gravity, the work succeeded at identifying the steps from proportionality to equality to yield variations of proportionality constants: including the one that eluded @stewartDemographicGravitationEvidence1948 and has been ignored in almost all subsequent accessibility research.

# Gravity-based accessibility's cousin: Wilson's spatial interaction model

Today's gravity-based accessibility measures (@eq-accessibility-general) share the same early 20th century Newtonian-based origins as the model's of Reilly, Zipf, and Stewart, versions of which continue to be extensively used [@ortuzar_2011_modelling;@wilson1971]. However, in some ways the gravity model and spatial interaction continued to evolve independently from @eq-accessibility-general, the former being developed into formalized transportation demand modelling practice to 'predict-and-provide', and the later taken up to describe land-use and transportation interactions by geography and social science-adjacent researchers and planners.

There are plenty of insights to be shared across these sibling branches; they are both spatial interaction models From the perspective of gravity-based accessibility measure, this paper's focus is on the proportionality constant of the spatial interaction model, which takes the following form after Wilson [-@wilson1971]: 
 
$$
T_{ij} = k W_i^{(1)} W_j^{(2)} f(c_{ij})
$${#eq-phys-gravity-model}


<!--Explain the features of the gravity model of today (Wilson) -->
Where $T_{ij}$ represents a $n$ x $m$ matrix of flows between an $n$ number of origins $i$ and an $m$ number of destinations $j$, $W_i^{(1)}$ and $W_j^{(2)}$ is a vector of mass attributes representing origin $i$ and destination $j$ respectively, and $f(c_{ij})$ is a $n$ x $m$ matrix representing some function of travel cost $c_{ij}$ which reflects travel impedance. In other words, $T_{ij}$ explicitly measures _interaction_ as a unit of trips and the single proportionality constant $k$ ensures the total sum of $T_{ij}$ represents the total flows in the data. It should be noted that the early analogy with the gravitational law proved too simplistic, and improvements to the gravity model (@eq-phys-gravity-model) are the use of total trip ends (number of originating trips from zone $i$ are $O_i$ and ending trips at zone $j$ are $D_j$) instead of total populations and separation distance calibrated by a power $n$ (such as $P_i$, $P_j$, and $n$ in @eq-zipf, @eq-reilly and @eq-stewart-force). Finally, and of most important note in this paper, $k$ is a scale parameter that makes the overall equation proportional to the rate characteristic of the modeled phenomenon.


## Entropy maximising: the gravity-model as statistical averages

Traditionally, the development of the gravity model has put an emphasis on the interpretability of the resulting units [@kirbyNormalizingFactorsGravity1970; @wilsonSTATISTICALTHEORYSPATIAL1967;@wilson1971]. But instead of relying on the heuristic Newtonian gravity analogy, entropy maximisation has emerged as a popular model building approach taken in the spatial interaction studies to generate the gravity model [@ortuzar_2011_modelling]. Namely, it is mathematically rigorousness and offers a sensible interpretation of the resulting model as a statistical averaging procedure [@wilson1971;@seniorGravityModellingEntropy1979].

As such, @eq-phys-gravity-model can be derived to account for additional information to include constraints that reflect known information about the system and is mathematically rigorous. The interaction variable $T_ij$ is often in the unit of trips, so additional knowledge can be the total trip flows originating at each zone $W_i^{(1)}$ and the total trip flows terminating at zone $W_j^{(2)}$. These pieces of information can constrain $T_{ij}$ as follows.

The total flow constraint: @eq-constraint0-gravitymodel, where the total number of flows in the region equals $T$. Along a similar region-wide perspective, the total flows multiplied by their travel cost in the region is constrained to equal $C$:
$$
\sum_i\sum_j T_{ij} = T
$${#eq-constraint0-gravitymodel}

$$
\sum_i\sum_j T_{ij} c_{ij} = C
$${#eq-constraint0_5-gravitymodel}

The production constraint: the sum of trips ending at each $j$ is equal to the total flow originating from each $i$:
$$
\sum_j T_{ij} = W_i^{(1)}
$${#eq-constraint1-gravitymodel}

The attraction constraint: the sum of trips starting at each $i$ is equal to the total flow ending at each $j$:
$$
\sum_i T_{ij} = W_j^{(2)}
$${#eq-constraint2-gravitymodel}


The entropy maximation derivation is demonstrated in detail elsewhere (e.g., @ortuzar_2011_modelling, @wilsonSTATISTICALTHEORYSPATIAL1967). The basis of the approach is to accept that there are macro, meso, and micro states. In the case of trips being the interaction variable, a micro state is an individual trip maker, the meso state is the statistically representative zone representing a collection of indiivudal trip makers, and the macro state is the entire study region. Using these assumptions, we aim to find a set of $T_{ij}$ that maximizes the number of micro states in each meso state subject to some sensible macro-state constraints (@eq-constraint0_5-gravitymodel, @eq-constraint1-gravitymodel, and @eq-constraint2-gravitymodel). From this approach, the gravity model can be interpreted to say that given the total number of individual trips (micro level) statistically represented at origin and destination zones (meso level), the cost of travelling (micro level, represented at the meso level), and the fixed total cost of travelling in the region (number of trips and cost of travel at the macro level). There is then a most probable distribution of trips between zones (meso-states) that stasis all the macro-state constraints.

Using these constraints, the gravity model @eq-phys-gravity-model is can now be distinguished into four general cases. These cases are presented in increase order of constraint restrictiveness and continued to be useful in classifying the gravity model in trip distribution modelling to this day [@ortuzar_2011_modelling]: 

- The unconstrained case: neither @eq-constraint0_5-gravitymodel, @eq-constraint1-gravitymodel, or @eq-constraint2-gravitymodel hold;
- The total constrained case: only @eq-constraint0-gravitymodel hold
- The singly-constrained case: either @eq-constraint1-gravitymodel holds (origin-constrained) <!-- production--> or @eq-constraint2-gravitymodel holds (destination-constrained)<!-- attraction-->; 
- The doubly-constrained case: both @eq-constraint1-gravitymodel and @eq-constraint2-gravitymodel hold simultaneously <!--production-attraction-->

In each of these four cases, the single proportionality constant $k$ is replaced by balancing factors $A_i$, $B_j$, and $K$ as follows to ensure the case-specific constraints are satisfied:
$$
A_i = \frac{1}{\sum_j B_j W_j^{(2)} f(c_{ij})}
$${#eq-bf-A-gravitymodel}

$$
B_j = \frac{1}{\sum_i A_i W_i^{(1)} f(c_{ij})}
$${#eq-bf-B-gravitymodel}
<!--PRETTY SURE YOU DON'T GET K FROM ENTROPY MAXIMAISATION...-->
$$
K = \frac{T}{\sum_i \sum_j W_i^{(1)} W_j^{(2)} f(c_{ij})}
$${#eq-bf-K-gravitymodel}

For the doubly-constrained case, $A_i$ and $B_j$ must be solved together along with $K$. For the singly-constrained cases, origin-constrained case replaces $B_j$ with 1 for all $j$ and $A_i$ is @eq-bf-A-gravitymodel, and the the destination-constrained case replaces $A_i$ with 1 for all $i$ and $B_j$ is @eq-bf-B-gravitymodel. For both singly-constrained cases, $K$ also holds. For the total constrained case, $A_i$ and $B_j$ are set to 1 and $K$ is the defining constraint. And for the unconstrained case, in a way, all other cases (the total constrained, singly-constrained and doubly-constrained cases) are simply constrained variations.

The following are simple numerical examples of each case assuming the following $T_{ij}$ matrix and a $f(c_{ij}) = \frac{1}{c_{ij}}$.

The variables:
```{r}
T_1 <- matrix(c(95, 23, 42, 27, 378, 45, 38, 36, 106), ncol = 3, byrow = TRUE)

T_1
```

```{r}
C <- matrix(c(2, 15, 5, 15, 2, 10, 5, 10, 2), ncol = 3, byrow = TRUE)

C
```

```{r}
O_i <- rowSums(T_1)
D_j <- colSums(T_1)

O_i
D_j
```

```{r}
T <- sum(sum(T_1))

T
```


## Unconstrained interaction case

$$
\hat{T_{ij}} = \frac{O_i\cdot D_j}{C_ij}
$$

```{r}
T_unc <- O_i %*% t(D_j) / C

T_unc
```

If we do the sums over rows, columns and all:
```{r}
rowSums(T_unc)
colSums(T_unc)
sum(sum(T_unc))
```

## Total constrained interaction case

Needs a single/global proportionality constant.
$$
\hat{T_{ij}} = k\frac{O_i\cdot D_j}{C_{ij}}
$$

```{r}
k <- T/sum(sum(T_unc))
k
```

```{r}
T_tot <- k * T_unc

T_tot
```

Let's check those marginals and total:
```{r}
rowSums(T_tot)
colSums(T_tot)
sum(sum(T_tot))
```

Destination constrained:
$$
\hat{T_{ij}} = \frac{B_j\cdot O_i\cdot D_j}{C_{ij}}
$$
```{r}
B_j <- colSums(T_1)/colSums(T_unc)

B_j <- matrix(rep(B_j, 3), ncol = 3, byrow = TRUE)

B_j
```

```{r}
T_dest <- B_j * T_unc

T_dest
```

Let's check those marginals and total:
```{r}
rowSums(T_dest)
colSums(T_dest)
sum(sum(T_dest))
```

Origin constrained:
$$
\hat{T_{ij}} = \frac{A_i\cdot O_i\cdot D_j}{C_{ij}}
$$

```{r}
A_i <- rowSums(T_1)/rowSums(T_unc)

A_i <- matrix(rep(A_i, 3), ncol = 3, byrow = FALSE)

A_i
```

```{r}
T_orig <- A_i * T_unc

T_orig
```

Let's check those marginals and total:
```{r}
rowSums(T_orig)
colSums(T_orig)
sum(sum(T_orig))
```


Now how does this translate to accessibility?

Opportunities (say, grocery stores):
```{r}
D_j <- c(7, 3, 2)
```

Unconstrained accessibility (no proportionality constant):
$$
S_i = \sum_j\frac{D_j}{C_{ij}}
$$

```{r}
S_i <- (1/C) %*% D_j
```

These numbers are proportional to the accessibility (i.e., higher or lower), but are not scaled to number of stores. Check the sum:
```{r}
sum(S_i)
```

Total flow constrained accessibility, needs a balancing factor:
```{r}
k <- sum(D_j)/sum(S_i)

k
```

Total flow constrained accessibility:
Unconstrained accessibility (no proportionality constant):
$$
S_i = k\sum_j\frac{D_j}{C_{ij}}
$$

```{r}
S_tot <- k * S_i

S_tot
```

Now check the sum:
```{r}
sum(S_tot)
```




# A family of accessibility measures

Imagine if the interaction variable was in fact _potential_ interaction, and the units were trips but opportunities. We don't have to change much!


Referring to the preceding section, the entropy maximizing method can be used to derive an equivalent family of measures, but for the case of accessibility where the _interaction_ variable is $V_{ij}$, represent _potential interaction_, i.e., the number of potential reachable opportunities. $T_{ij}$ in @eq-phys-gravity-model can be replaced with $V_{ij}$ and presented as follows: 

$$
V_{ij} = k O_i D_j f(c_{ij})
$${#eq-access}

Where $V_{ij}$ represents a $n$ x $m$ matrix of potential reachable opportunities between an $n$ number of origins $i$ and an $m$ number of destinations $j$, $O_i$ and $D_j$ is a vector of mass attributes representing origin $i$ and destination $j$ respectively, and $f(c_{ij})$ is a $n$ x $m$ matrix representing some function of travel cost $c_{ij}$ which reflects travel impedance. In other words, $V_{ij}$ explicitly measures _potential interaction_ as a unit of number of potentially reachable opportunities and the single proportionality constant $k$ ensures the total sum of $V_{ij}$ represents the total potential reachable opportunities in the data. Finally, and of most important note in this paper, $k$ is a scale parameter that makes the overall equation proportional to the rate characteristic of the modeled phenomenon.

Like with @eq-phys-gravity-model, we distinguish @eq-access into FIVE cases based on versions of the gravity-model building constraints (@eq-constraint1-gravitymodel,  @eq-constraint2-gravitymodel, and @eq-constraint3-gravitymodel). To inform each case of @eq-access with constraints that reflect knowledge of the macro-state, the total trip flow $O_i$ originating at each $i$ and the total trip flows $D_j$ terminating at $j$ are used. These pieces of information can constrain $V_{ij}$ as follows, ensuring it reflects this macro-level knowledge, i.e., the sum of the number of potential reachable opportunities. 

$$
\sum_j V_{ij} = O_i
$${#eq-constraint1-access}
\noindent Where sum of all potentially reachable opportunities for all $j$ zones in the region is equal to the opportunities originating $O_i$ at each $i$ in the region.

$$
\sum_i V_{ij} = D_j
$${#eq-constraint2-access}
\noindent Where sum of all potentially reachable opportunities for all $i$ zones in the region is equal to the opportunities ending $D_i$ at each $j$ in the region.

$$
\sum_{i}\sum_{j} V_{ij} c_{ij} = C
$${#eq-constraint3-access}
\noindent Where the sum of the travel cost of each potentially reached opportunity in the region is equal to a total travel cost $C$.

For all FIVE cases, @eq-constraint3-access holds <!--in the event C is known, it could be used to identify parameters in f(c_ij)... though model calibration is probably a better idea. --> but are differentiated like:
- neither @eq-constraint1-access or @eq-constraint2-access hold -- the unconstrained case;
- @eq-constraint1-access holds -- the production constrained case (origin-constrained, a singly-constrained case); 
- @eq-constraint2-access holds -- the attraction constrained case (destination-constrained, a singly-constrained case); 
- @eq-constraint1-access and @eq-constraint2-access both hold simultaneously -- the production-attraction constrained case (doubly-constrained).
- @eq-constraint1-access or @eq-constraint2-access partly hold -- hybrid production constrained case <!-- (could be repeated for attraction constrained case... and doubly constrained case)-->

Using the maximizing entropy approach... <!--DESCRIBING WHAT EACH MICRO/MESO/MACRO STATE IS HERE IN RELATION TO ACCESSIBILITY--> For each case...

## Unconstrained case

Neither @eq-constraint1-access or @eq-constraint2-access hold, so $V_ij'$ has no opportunity constraints!  

$$
V_{ij}' = k O_i D_j f(c_{ij})
$${#eq-access-unconstrained}

Where $k$ is two sets of balancing factors, $A_i'$ and $B_j'$, and both are equal to 1. 


## Singly-constrained case (origin-constrained)

Spatial availability; origin-constrained. 

Origins in human spatial interaction: "intervening opportunities and competing migrants" @stoufferInterveningOpportunitiesTheory1940 and @stoufferINTERVENINGOPPORTUNITIESCOMPETING1960, "axiomatically"  @weibull_axiomatic_1976, "for multiple-modes, as a rate" @shen1998; for multiple-modes, as the number of opportunities" @soukhovMultimodalSpatialAvailability2024

$$
V_{ij}'' = k O_i D_j f(c_{ij})
$${#eq-access-singlyconstrained}

<!--HOW DO WE FIT OUR EXISTING CONSTRAINTS INTO THESE BALANCING FACTORS..? $k O_i f(c_{ij}) = the balancing factors..?-->
$$
V_{ij}'' = O_j\frac{F^p_{ij} \cdot F^c_{ij}}{\sum_{i=1}^K F^p_{ij} \cdot F^c_{ij}}
$$
Population balancing factor:
$$
F^p_{ij} = \frac{P_{i\in r}^\alpha}{\sum_{i=1}^K P_{i\in r}^\alpha}
$$
Travel cost balancing factor:
$$
F^c_{ij} = \frac{f(c_{ij})}{\sum_{i=1}^K f(c_{ij})}
$$
## Singly-constrained case (destination-constrained)

Origins are in retail models, decision model for shops to optimally spatially locate to max. their potential consumer interaction. Starting with reilly's law of gravitational retail (1931), formalized later in @huffDefiningEstimatingTrading1964 and @lakshmananRetailMarketPotential1965. Spatial availability as another example.

## Doubly constrained case (origin-destination constrained)

(only when the units of the marginals are the same, therefore of more limited application)
ex. @hornerExploringMetropolitanAccessibility2004 and @allenMeasureCompetitiveAccess2020


## Hybrid singly-constrained case: 
<!--NOTE TO SELF: where does E2SFCA and 3SFCA fit??-->
Balanced floating catchment areas (not truly doubly constrained)

# Empirical examples

Use the TTS2016R package to illustrate every measure.

# Discussion

When to use each of these measures?

# Conclusions


# References

<!--the benefits of this formulation, and the inclusion of the propoartionality constant has been imense for spatial interaction modelling. For instance, the identification of the conovlution of spatial autocorrelation and and distance-decay @griffithSpatialStructureSpatial2007 -->

<!-- Wilson in @wilsonSTATISTICALTHEORYSPATIAL1967 was the first to connect accessibility measures to balancing factors-->

<!--
@wilson1971 (pg. 28) summarises the following checklist for spatial interaction model builders:
1. Nature of the spatial interaction variable; 
2. Nature of the mass terms
3. Measurement of mass terms
4. Measurement of interaction cost
5. Choice of cost function
6. Other terms
7. Design of spatial system
8. Calibration
9. Relation to general model framework
-->

<!-- (cool paper that explores this @kirbyNormalizingFactorsGravity1970 - he "shows that the Ai and Bj balancing factors are the mean values of the inverse of the function e^-N*F(c_ij) calculated by summing the function over i values for Ai factors and over j values for Bj factors." -->
